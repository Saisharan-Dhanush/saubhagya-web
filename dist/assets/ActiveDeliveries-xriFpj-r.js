import{j as e,d as p,R as D,a2 as j,f,aV as C,b2 as _,V as z,v as B,b1 as F,a as V,Y as M,s as v}from"./ui-vendor-BS7p1Zk0.js";import{r as m}from"./react-vendor-C1G9MTLI.js";import{C as l,f as i,B as d,d as u}from"./index-DZM7mZUF.js";import{t as $}from"./mockDataService-DPeHm-bU.js";import"./utils-BEJD3qDL.js";import"./charts-n2sHyWfT.js";const K=()=>{const[n,S]=m.useState([]),[b,U]=m.useState(!0),[w,y]=m.useState(null),[k,T]=m.useState(!1),[I,A]=m.useState(null);m.useEffect(()=>{g();const s=setInterval(g,3e4);return()=>clearInterval(s)},[]);const g=async()=>{try{b||T(!0);const s=await $.getActiveDeliveries();s.success?S(s.data):y("Failed to load active deliveries")}catch{y("Failed to load active deliveries")}finally{U(!1),T(!1)}},R=s=>{const r={pending:{color:"bg-gray-500",label:"Pending"},picked_up:{color:"bg-blue-500",label:"Picked Up"},in_transit:{color:"bg-yellow-500",label:"In Transit"},delivered:{color:"bg-green-500",label:"Delivered"},failed:{color:"bg-red-500",label:"Failed"}}[s];return e.jsx(u,{className:`${r.color} text-white`,children:r.label})},E=s=>{const a=new Date,t=(new Date(s).getTime()-a.getTime())/(1e3*60);return t<-15?{color:"text-red-600",label:"Late",icon:p}:t<0?{color:"text-yellow-600",label:"Arriving Soon",icon:f}:t<=15?{color:"text-blue-600",label:"On Time",icon:v}:{color:"text-green-600",label:"Early",icon:v}},P=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=s=>new Date(s).toLocaleString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=()=>{const s=n.length,a=n.filter(c=>c.status==="pending").length,r=n.filter(c=>c.status==="in_transit").length,t=n.filter(c=>c.status==="picked_up").length,x=new Date,N=n.filter(c=>new Date(c.estimatedArrival)<x&&!["delivered","failed"].includes(c.status)).length;return{total:s,pending:a,inTransit:r,pickedUp:t,lateCount:N}};if(b)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Active Deliveries"}),e.jsx("p",{className:"text-muted-foreground",children:"Track live delivery status and locations"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:4}).map((s,a)=>e.jsx(l,{children:e.jsxs(i,{className:"pt-6",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]})},a))})]});if(w)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Active Deliveries"}),e.jsx("p",{className:"text-muted-foreground",children:"Track live delivery status and locations"})]}),e.jsx(l,{className:"border-red-200 bg-red-50",children:e.jsxs(i,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(p,{className:"h-5 w-5"}),e.jsx("span",{children:w})]}),e.jsx(d,{onClick:()=>window.location.reload(),className:"mt-4",variant:"outline",children:"Retry"})]})})]});const h=L();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Active Deliveries"}),e.jsx("p",{className:"text-muted-foreground",children:"Track live delivery status and locations"})]}),e.jsxs(d,{onClick:g,disabled:k,variant:"outline",children:[k?e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(D,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Active"}),e.jsx("p",{className:"text-2xl font-bold",children:h.total})]}),e.jsx(j,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:h.pending})]}),e.jsx(f,{className:"h-8 w-8 text-gray-600"})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Picked Up"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.pickedUp})]}),e.jsx(C,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"In Transit"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:h.inTransit})]}),e.jsx(_,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Running Late"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:h.lateCount})]}),e.jsx(p,{className:"h-8 w-8 text-red-600"})]})})})]}),e.jsxs("div",{className:"space-y-4",children:[n.map(s=>{const a=E(s.estimatedArrival),r=a.icon,t=s.trackingUpdates[s.trackingUpdates.length-1];return e.jsx(l,{className:"hover:shadow-md transition-shadow",children:e.jsxs(i,{className:"pt-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.customerName}),R(s.status),e.jsxs("div",{className:`flex items-center space-x-1 ${a.color}`,children:[e.jsx(r,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a.label})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Delivery #",s.id]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"truncate",children:s.customerAddress})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[s.biogasQuantity,"kg Biogas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["ETA: ",P(s.estimatedArrival)]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:"Vehicle:"}),e.jsx(u,{variant:"outline",children:s.vehicleId})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:"Driver:"}),e.jsx(u,{variant:"outline",children:s.driverId})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:"Route:"}),e.jsx(u,{variant:"outline",children:s.routeId})]})]}),t&&e.jsx("div",{className:"p-3 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-800",children:["Latest Update: ",t.status]}),t.notes&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:t.notes})]}),e.jsx("span",{className:"text-xs text-blue-600",children:o(t.timestamp)})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600",children:[s.startTime&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Started:"})," ",o(s.startTime)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Estimated Arrival:"})," ",o(s.estimatedArrival)]}),s.actualArrival&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Actual Arrival:"})," ",o(s.actualArrival)]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 min-w-[120px]",children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>A(s),children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Track"]}),e.jsxs(d,{size:"sm",variant:"outline",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Call"]}),s.status==="in_transit"&&e.jsxs(d,{size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"Confirm"]}),s.status==="pending"&&e.jsxs(d,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"Dispatch"]})]})]}),I?.id===s.id&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Tracking Timeline"}),e.jsx("div",{className:"space-y-3",children:s.trackingUpdates.map((x,N)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:x.status}),x.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:x.notes})]}),e.jsx("span",{className:"text-xs text-gray-500",children:o(x.timestamp)})]})})]},N))}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>A(null),className:"mt-3",children:"Hide Timeline"})]})]})},s.id)}),n.length===0&&e.jsx(l,{children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No active deliveries"}),e.jsx("p",{className:"text-gray-500",children:"All deliveries have been completed or none are scheduled."})]})})})]})]})};export{K as ActiveDeliveries,K as default};
//# sourceMappingURL=ActiveDeliveries-xriFpj-r.js.map
