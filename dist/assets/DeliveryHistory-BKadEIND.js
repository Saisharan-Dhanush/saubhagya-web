import{j as e,K as P,x as k,ak as I,J as z,X as U,I as b,S as _,a6 as q,au as J,a3 as K,p as O,_ as Q,bq as W,ap as X,a as $,af as G}from"./ui-vendor-CnKvLbpM.js";import{r as d}from"./react-vendor-XSK8c6JV.js";import{C as i,f as c,B as j,d as f}from"./index-Cwg1D4Xy.js";import{t as Y}from"./mockDataService-DPeHm-bU.js";import"./utils-Bj4fnUCk.js";import"./charts-D-uCZeDt.js";const ie=()=>{const[o,A]=d.useState([]),[F,w]=d.useState(!0),[D,C]=d.useState(null),[g,L]=d.useState(""),[N,H]=d.useState(!1),[Z,B]=d.useState(null),[t,h]=d.useState({status:["delivered"],dateRange:{start:"",end:""},vehicleId:"",driverId:"",priority:[]});d.useEffect(()=>{E()},[]);const E=async()=>{try{w(!0);const s=await Y.getDeliveryHistory();s.success?A(s.data):C("Failed to load delivery history")}catch{C("Failed to load delivery history")}finally{w(!1)}},M=s=>{const r={delivered:{color:"bg-green-500",label:"Delivered"},failed:{color:"bg-red-500",label:"Failed"},cancelled:{color:"bg-gray-500",label:"Cancelled"}}[s]||{color:"bg-gray-500",label:"Unknown"};return e.jsx(f,{className:`${r.color} text-white`,children:r.label})},S=o.filter(s=>{const a=s.customerName.toLowerCase().includes(g.toLowerCase())||s.customerAddress.toLowerCase().includes(g.toLowerCase()),r=!t.status||t.status.length===0||t.status.includes(s.status),n=!t.vehicleId||s.vehicleId===t.vehicleId,m=!t.driverId||s.driverId===t.driverId;let x=!0;if(t.dateRange?.start&&t.dateRange?.end){const p=new Date(s.actualArrival||s.estimatedArrival),l=new Date(t.dateRange.start),y=new Date(t.dateRange.end);x=p>=l&&p<=y}return a&&r&&n&&m&&x}),v=s=>new Date(s).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=s=>{if(!s.startTime||!s.actualArrival)return null;const a=new Date(s.startTime),n=new Date(s.actualArrival).getTime()-a.getTime();return Math.round(n/(1e3*60))},T=s=>{if(!s.actualArrival)return!1;const a=new Date(s.estimatedArrival);return new Date(s.actualArrival)>a},V=()=>{const s=o.length,a=o.filter(l=>l.status==="delivered").length,r=o.filter(l=>l.status==="failed").length,n=o.filter(l=>l.status==="delivered"&&!T(l)).length,m=a>0?n/a*100:0,x=o.filter(l=>l.status==="delivered"&&l.startTime&&l.actualArrival),p=x.length>0?x.reduce((l,y)=>l+(R(y)||0),0)/x.length:0;return{total:s,delivered:a,failed:r,onTime:n,onTimeRate:Math.round(m),avgDuration:Math.round(p)}};if(F)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Delivery History"}),e.jsx("p",{className:"text-muted-foreground",children:"View completed deliveries and performance metrics"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:5}).map((s,a)=>e.jsx(i,{children:e.jsxs(c,{className:"pt-6",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]})},a))})]});if(D)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Delivery History"}),e.jsx("p",{className:"text-muted-foreground",children:"View completed deliveries and performance metrics"})]}),e.jsx(i,{className:"border-red-200 bg-red-50",children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{children:D})]}),e.jsx(j,{onClick:()=>window.location.reload(),className:"mt-4",variant:"outline",children:"Retry"})]})})]});const u=V();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Delivery History"}),e.jsx("p",{className:"text-muted-foreground",children:"View completed deliveries and performance metrics"})]}),e.jsxs(j,{variant:"outline",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Deliveries"}),e.jsx("p",{className:"text-2xl font-bold",children:u.total})]}),e.jsx(I,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Successful"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:u.delivered})]}),e.jsx(z,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:u.failed})]}),e.jsx(U,{className:"h-8 w-8 text-red-600"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"On-Time Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[u.onTimeRate,"%"]})]}),e.jsx(b,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Duration"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[u.avgDuration,"min"]})]}),e.jsx(b,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsx(i,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by customer name or address...",className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:g,onChange:s=>L(s.target.value)})]}),e.jsxs(j,{variant:"outline",onClick:()=>H(!N),className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Filters"})]})]}),N&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:t.dateRange?.start||"",onChange:s=>h({...t,dateRange:{...t.dateRange,start:s.target.value}})}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:t.dateRange?.end||"",onChange:s=>h({...t,dateRange:{...t.dateRange,end:s.target.value}})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsx("div",{className:"space-y-2",children:["delivered","failed","cancelled"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:t.status?.includes(s)||!1,onChange:a=>{const r=t.status||[],n=a.target.checked?[...r,s]:r.filter(m=>m!==s);h({...t,status:n})}}),e.jsx("span",{className:"text-sm capitalize",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Vehicle"}),e.jsx("input",{type:"text",placeholder:"Vehicle ID",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:t.vehicleId||"",onChange:s=>h({...t,vehicleId:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Driver"}),e.jsx("input",{type:"text",placeholder:"Driver ID",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:t.driverId||"",onChange:s=>h({...t,driverId:s.target.value})})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[S.map(s=>{const a=T(s),r=R(s);return e.jsx(i,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.customerName}),M(s.status),s.status==="delivered"&&a&&e.jsx(f,{className:"bg-yellow-500 text-white",children:"Late"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["#",s.id]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[s.biogasQuantity,"kg Biogas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["Vehicle: ",s.vehicleId]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["Driver: ",s.driverId]})]}),r&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["Duration: ",r,"min"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.customerAddress})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[s.startTime&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Started:"}),e.jsx("div",{children:v(s.startTime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Expected:"}),e.jsx("div",{children:v(s.estimatedArrival)})]}),s.actualArrival&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Completed:"}),e.jsx("div",{className:a?"text-red-600":"text-green-600",children:v(s.actualArrival)})]})]}),s.deliveryConfirmation&&e.jsx("div",{className:"p-3 bg-green-50 border-l-4 border-green-400 rounded-r-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Delivery Confirmed"}),e.jsxs("p",{className:"text-sm text-green-700",children:["By: ",s.deliveryConfirmation.confirmedBy]}),s.deliveryConfirmation.notes&&e.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Notes: ",s.deliveryConfirmation.notes]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.deliveryConfirmation.customerSignature&&e.jsxs(f,{variant:"outline",className:"text-green-700",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Signed"]}),s.deliveryConfirmation.photo&&e.jsxs(f,{variant:"outline",className:"text-green-700",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Photo"]})]})]})})]}),e.jsxs("div",{className:"flex flex-col space-y-2 min-w-[120px]",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>B(s),children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Details"]}),e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"Receipt"]}),s.status==="delivered"&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(G,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:"4.8"})]})]})]})})},s.id)}),S.length===0&&e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No delivery history found"}),e.jsx("p",{className:"text-gray-500",children:g||N?"Try adjusting your search or filters.":"No completed deliveries yet."})]})})})]})]})};export{ie as DeliveryHistory,ie as default};
//# sourceMappingURL=DeliveryHistory-BKadEIND.js.map
