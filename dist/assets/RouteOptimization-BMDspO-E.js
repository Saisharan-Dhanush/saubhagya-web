import{j as e,$ as L,o as S,Z as z,t as $,b2 as M,g as _,bz as H,Y as Z,bA as G,b1 as R}from"./ui-vendor-CcKJai5_.js";import{r as l}from"./react-vendor-C1G9MTLI.js";import{C as o,f as x,B as c,b as D,c as k,e as O,d as h}from"./index-C8JM5vnN.js";import{t as P}from"./mockDataService-DPeHm-bU.js";import"./utils-BEJD3qDL.js";import"./charts-C1Edd5FR.js";const W=()=>{const[p,j]=l.useState([]),[g,F]=l.useState(null),[u,v]=l.useState(!1),[r,f]=l.useState(null),[T,N]=l.useState(!0),[y,b]=l.useState(null),[C,m]=l.useState(!1),[i,d]=l.useState({prioritizeBy:"time",maxDeliveriesPerRoute:8,maxDistancePerRoute:100,considerTrafficConditions:!0,considerVehicleCapacity:!0,considerDriverPreferences:!1,operatingHours:{start:"06:00",end:"18:00"}});l.useEffect(()=>{(async()=>{try{N(!0);const t=await P.getRoutes();t.success?j(t.data):b("Failed to load routes")}catch{b("Failed to load routes")}finally{N(!1)}})()},[]);const A=async s=>{if(s)try{v(!0),F(s);const t={...s},n=await P.optimizeRoute(s.id);if(n.success){const a=n.data,B={distanceReduction:t.totalDistance-a.totalDistance,timeReduction:t.estimatedDuration-a.estimatedDuration,fuelSavings:t.fuelCost-a.fuelCost,costSavings:t.fuelCost+t.tollCost-(a.fuelCost+a.tollCost)};f({originalRoute:t,optimizedRoute:a,improvements:B}),j(E=>E.map(w=>w.id===s.id?a:w))}}catch{}finally{v(!1)}},I=s=>{const n={planned:{color:"bg-blue-500",label:"Planned"},active:{color:"bg-green-500",label:"Active"},completed:{color:"bg-gray-500",label:"Completed"},cancelled:{color:"bg-red-500",label:"Cancelled"}}[s];return e.jsx(h,{className:`${n.color} text-white`,children:n.label})},V=s=>s>=90?{color:"text-green-600",label:"Excellent"}:s>=75?{color:"text-blue-600",label:"Good"}:s>=60?{color:"text-yellow-600",label:"Average"}:{color:"text-red-600",label:"Poor"};return T?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Route Optimization"}),e.jsx("p",{className:"text-muted-foreground",children:"Optimize delivery routes for efficiency and cost savings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:3}).map((s,t)=>e.jsx(o,{children:e.jsxs(x,{className:"pt-6",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]})},t))})]}):y?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Route Optimization"}),e.jsx("p",{className:"text-muted-foreground",children:"Optimize delivery routes for efficiency and cost savings"})]}),e.jsx(o,{className:"border-red-200 bg-red-50",children:e.jsxs(x,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(L,{className:"h-5 w-5"}),e.jsx("span",{children:y})]}),e.jsx(c,{onClick:()=>window.location.reload(),className:"mt-4",variant:"outline",children:"Retry"})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Route Optimization"}),e.jsx("p",{className:"text-muted-foreground",children:"Optimize delivery routes for efficiency and cost savings"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>m(!C),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Settings"]}),e.jsxs(c,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Optimize All"]})]})]}),C&&e.jsxs(o,{children:[e.jsxs(D,{children:[e.jsxs(k,{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:"Optimization Settings"})]}),e.jsx(O,{children:"Configure how routes should be optimized"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Prioritize By"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md px-3 py-2",value:i.prioritizeBy,onChange:s=>d({...i,prioritizeBy:s.target.value}),children:[e.jsx("option",{value:"time",children:"Time"}),e.jsx("option",{value:"distance",children:"Distance"}),e.jsx("option",{value:"fuel_cost",children:"Fuel Cost"}),e.jsx("option",{value:"customer_priority",children:"Customer Priority"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Max Deliveries per Route"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:i.maxDeliveriesPerRoute,onChange:s=>d({...i,maxDeliveriesPerRoute:parseInt(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Max Distance (km)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:i.maxDistancePerRoute,onChange:s=>d({...i,maxDistancePerRoute:parseInt(s.target.value)})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"traffic",checked:i.considerTrafficConditions,onChange:s=>d({...i,considerTrafficConditions:s.target.checked})}),e.jsx("label",{htmlFor:"traffic",className:"text-sm font-medium",children:"Consider Traffic Conditions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"capacity",checked:i.considerVehicleCapacity,onChange:s=>d({...i,considerVehicleCapacity:s.target.checked})}),e.jsx("label",{htmlFor:"capacity",className:"text-sm font-medium",children:"Consider Vehicle Capacity"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"preferences",checked:i.considerDriverPreferences,onChange:s=>d({...i,considerDriverPreferences:s.target.checked})}),e.jsx("label",{htmlFor:"preferences",className:"text-sm font-medium",children:"Consider Driver Preferences"})]})]}),e.jsxs("div",{className:"mt-6 flex space-x-2",children:[e.jsx(c,{onClick:()=>m(!1),children:"Apply Settings"}),e.jsx(c,{variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]}),r&&e.jsxs(o,{className:"border-green-200 bg-green-50",children:[e.jsxs(D,{children:[e.jsxs(k,{className:"flex items-center space-x-2 text-green-800",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("span",{children:"Optimization Results"})]}),e.jsxs(O,{children:["Route optimization completed for ",r.originalRoute.name]})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["-",r.improvements.distanceReduction.toFixed(1),"km"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Distance Saved"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["-",r.improvements.timeReduction,"min"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Time Saved"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["₹",r.improvements.fuelSavings.toFixed(0)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Fuel Savings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["₹",r.improvements.costSavings.toFixed(0)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Savings"})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[e.jsx(c,{className:"bg-green-600 hover:bg-green-700",children:"Apply Optimization"}),e.jsx(c,{variant:"outline",onClick:()=>f(null),children:"Dismiss"})]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[p.map(s=>{const t=V(s.optimizationScore);return e.jsx(o,{className:"hover:shadow-md transition-shadow",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.name}),I(s.status)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Route ID: ",s.id]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[s.totalDistance,"km"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[s.estimatedDuration,"min"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["₹",s.fuelCost]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[s.waypoints.length," stops"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Start:"}),e.jsx("span",{className:"text-gray-600",children:s.startLocation.address})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"End:"}),e.jsx("span",{className:"text-gray-600",children:s.endLocation.address})]})]}),s.waypoints.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Delivery Stops:"}),e.jsxs("div",{className:"space-y-1",children:[s.waypoints.slice(0,3).map((n,a)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full"}),e.jsx("span",{children:n.address}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",new Date(n.estimatedArrival).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),")"]})]},a)),s.waypoints.length>3&&e.jsxs("div",{className:"text-sm text-gray-500 ml-4",children:["+",s.waypoints.length-3," more stops"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Optimization Score"}),e.jsxs("div",{className:`text-2xl font-bold ${t.color}`,children:[s.optimizationScore,"%"]}),e.jsx("div",{className:`text-sm ${t.color}`,children:t.label})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsxs("div",{children:["Total Cost: ₹",(s.fuelCost+s.tollCost).toLocaleString()]}),e.jsxs("div",{children:["Toll: ₹",s.tollCost]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(c,{onClick:()=>A(s),disabled:u&&g?.id===s.id,className:"bg-blue-600 hover:bg-blue-700",children:u&&g?.id===s.id?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}),"Optimizing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Optimize"]})}),e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"View Details"]})]}),(s.assignedVehicleId||s.assignedDriverId)&&e.jsxs("div",{className:"text-right text-sm space-y-1",children:[s.assignedVehicleId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vehicle: "}),e.jsx(h,{variant:"outline",children:s.assignedVehicleId})]}),s.assignedDriverId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Driver: "}),e.jsx(h,{variant:"outline",children:s.assignedDriverId})]})]})]})]})})},s.id)}),p.length===0&&e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No routes found"}),e.jsx("p",{className:"text-gray-500",children:"No delivery routes have been created yet."})]})})})]})]})};export{W as RouteOptimization,W as default};
//# sourceMappingURL=RouteOptimization-BMDspO-E.js.map
