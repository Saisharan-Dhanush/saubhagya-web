import{j as e,d as y,aV as N,s as h,V as $,f as L,bf as R,al as z,z as V,X as q,F as H}from"./ui-vendor-BS7p1Zk0.js";import{r as l}from"./react-vendor-C1G9MTLI.js";import{C as o,f as m,B as c,b,c as C,d as w,e as S}from"./index-DZM7mZUF.js";import{t as k}from"./mockDataService-DPeHm-bU.js";import"./utils-BEJD3qDL.js";import"./charts-n2sHyWfT.js";const K=()=>{const[x,j]=l.useState([]),[t,u]=l.useState(null),[a,i]=l.useState({deliveryId:"",confirmedBy:"",customerSignature:"",photo:"",notes:"",actualQuantity:0,customerSatisfaction:5,deliveryIssues:[]}),[D,p]=l.useState(!0),[f,g]=l.useState(!1),[v,d]=l.useState(null),I=["Late delivery","Quantity discrepancy","Quality issues","Customer unavailable","Access problems","Equipment malfunction","Documentation issues"];l.useEffect(()=>{Q()},[]);const Q=async()=>{try{p(!0);const s=await k.getActiveDeliveries();if(s.success){const r=s.data.filter(n=>n.status==="in_transit"||n.status==="picked_up");j(r)}else d("Failed to load pending deliveries")}catch{d("Failed to load pending deliveries")}finally{p(!1)}},P=s=>{u(s),i({deliveryId:s.id,confirmedBy:"Driver",customerSignature:"",photo:"",notes:"",actualQuantity:s.biogasQuantity,customerSatisfaction:5,deliveryIssues:[]})},A=s=>{const r=a.deliveryIssues,n=r.includes(s)?r.filter(E=>E!==s):[...r,s];i({...a,deliveryIssues:n})},F=()=>{i({...a,customerSignature:`signature_${Date.now()}.png`})},B=()=>{i({...a,photo:`delivery_photo_${Date.now()}.jpg`})},T=async()=>{if(t)try{g(!0),(await k.confirmDelivery(t.id,a)).success?(j(r=>r.filter(n=>n.id!==t.id)),u(null),i({deliveryId:"",confirmedBy:"",customerSignature:"",photo:"",notes:"",actualQuantity:0,customerSatisfaction:5,deliveryIssues:[]}),alert("Delivery confirmed successfully!")):d("Failed to confirm delivery")}catch{d("Failed to confirm delivery")}finally{g(!1)}},_=s=>new Date(s).toLocaleString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return D?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Delivery Confirmation"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm completed deliveries and collect customer feedback"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:Array.from({length:3}).map((s,r)=>e.jsx(o,{children:e.jsxs(m,{className:"pt-6",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]})},r))})]}):v?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Delivery Confirmation"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm completed deliveries and collect customer feedback"})]}),e.jsx(o,{className:"border-red-200 bg-red-50",children:e.jsxs(m,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsx("span",{children:v})]}),e.jsx(c,{onClick:()=>window.location.reload(),className:"mt-4",variant:"outline",children:"Retry"})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Delivery Confirmation"}),e.jsx("p",{className:"text-muted-foreground",children:"Confirm completed deliveries and collect customer feedback"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(b,{children:[e.jsxs(C,{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"h-5 w-5"}),e.jsx("span",{children:"Pending Confirmations"}),e.jsx(w,{variant:"outline",children:x.length})]}),e.jsx(S,{children:"Deliveries ready for confirmation"})]}),e.jsx(m,{children:x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-500",children:"No deliveries pending confirmation."})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${t?.id===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>P(s),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",s.id]})]}),e.jsx(w,{className:"bg-yellow-500 text-white",children:s.status==="in_transit"?"In Transit":"Picked Up"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:s.customerAddress})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.biogasQuantity,"kg Biogas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{children:["ETA: ",_(s.estimatedArrival)]})]})]})]},s.id))})})]}),e.jsxs(o,{children:[e.jsxs(b,{children:[e.jsxs(C,{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"h-5 w-5"}),e.jsx("span",{children:"Confirmation Details"})]}),e.jsx(S,{children:t?`Confirming delivery for ${t.customerName}`:"Select a delivery to confirm"})]}),e.jsx(m,{children:t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Delivery Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Customer:"}),e.jsx("span",{className:"font-medium",children:t.customerName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Scheduled Quantity:"}),e.jsxs("span",{className:"font-medium",children:[t.biogasQuantity,"kg"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery ID:"}),e.jsxs("span",{className:"font-medium",children:["#",t.id]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Confirmed By"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md px-3 py-2",value:a.confirmedBy,onChange:s=>i({...a,confirmedBy:s.target.value}),children:[e.jsx("option",{value:"Driver",children:"Driver"}),e.jsx("option",{value:"Customer",children:"Customer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Actual Quantity Delivered (kg)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded-md px-3 py-2",value:a.actualQuantity,onChange:s=>i({...a,actualQuantity:parseFloat(s.target.value)||0})}),a.actualQuantity!==t.biogasQuantity&&e.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Quantity differs from scheduled amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Satisfaction (1-5)"}),e.jsx("div",{className:"flex space-x-2",children:[1,2,3,4,5].map(s=>e.jsx(c,{variant:a.customerSatisfaction===s?"default":"outline",size:"sm",onClick:()=>i({...a,customerSatisfaction:s}),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Delivery Issues (if any)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:I.map(s=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.deliveryIssues.includes(s),onChange:()=>A(s)}),e.jsx("span",{className:"text-sm",children:s})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Signature"}),e.jsxs(c,{variant:"outline",onClick:F,className:"w-full",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),a.customerSignature?"Signature Captured":"Capture Signature"]}),a.customerSignature&&e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"✓ Signature saved"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Delivery Photo"}),e.jsxs(c,{variant:"outline",onClick:B,className:"w-full",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),a.photo?"Photo Captured":"Take Photo"]}),a.photo&&e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"✓ Photo saved"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Additional Notes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md px-3 py-2",rows:3,placeholder:"Any additional comments or observations...",value:a.notes,onChange:s=>i({...a,notes:s.target.value})})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(c,{onClick:T,disabled:f,className:"flex-1 bg-green-600 hover:bg-green-700",children:f?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-pulse"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Confirm Delivery"]})}),e.jsxs(c,{variant:"outline",onClick:()=>u(null),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),(!a.customerSignature||!a.photo)&&e.jsx("div",{className:"p-3 border border-yellow-200 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(y,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:"Recommended:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[!a.customerSignature&&e.jsx("li",{children:"• Capture customer signature for verification"}),!a.photo&&e.jsx("li",{children:"• Take delivery photo for documentation"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"Select a pending delivery to begin confirmation process"})]})})]})]})]})};export{K as DeliveryConfirmation,K as default};
//# sourceMappingURL=DeliveryConfirmation-Bu8ZIs_Z.js.map
